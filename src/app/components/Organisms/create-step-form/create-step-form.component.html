<form class="create-step" [formGroup]="stepForm" (ngSubmit)="handleSubmit()">
  <section class="create-step__section">
    <h3>Nouvelle étape</h3>
    <div class="create-step__grid">
      <app-text-input
        formControlName="title"
        label="Nom de l'étape"
        placeholder="Nom de l'étape"
        [isRequired]="true"
        [errorMessage]="getControlError('title')"
      ></app-text-input>

      <app-text-input
        formControlName="city"
        label="Ville"
        placeholder="Ville"
        [isRequired]="true"
        [errorMessage]="getControlError('city')"
      ></app-text-input>
      <app-text-input
        formControlName="country"
        label="Pays"
        placeholder="Pays"
        [isRequired]="true"
        [errorMessage]="getControlError('country')"
      ></app-text-input>
      <app-text-input
        formControlName="continent"
        label="Continent"
        placeholder="Continent"
        [isRequired]="true"
        [errorMessage]="getControlError('continent')"
      ></app-text-input>

      <app-text-input
        formControlName="startDate"
        label="Début de l'étape"
        placeholder="Date et heure"
        type="datetime-local"
      ></app-text-input>

      <app-text-input
        formControlName="endDate"
        label="Fin de l'étape"
        placeholder="Date et heure"
        type="datetime-local"
      ></app-text-input>

      <app-select
        [itemsList]="availableThemes"
        label="Thème"
        placeholder="Choisissez un thème"
        [selectedId]="stepForm.get('themeId')?.value ?? null"
        [disabled]="availableThemes.length === 0"
        (selectOnChange)="onThemeChange($event)"
      ></app-select>

      <div class="create-step__coordinates">
        <app-text-input
          formControlName="latitude"
          label="Latitude"
          placeholder="Ex: 48.8566"
          [isRequired]="true"
          [errorMessage]="getControlError('latitude')"
        ></app-text-input>
        <app-text-input
          formControlName="longitude"
          label="Longitude"
          placeholder="Ex: 2.3522"
          [isRequired]="true"
          [errorMessage]="getControlError('longitude')"
        ></app-text-input>
      </div>

      <app-text-input
        formControlName="mediaUrl"
        label="Média principal (URL)"
        placeholder="Ajouter un média"
        icon="add"
      ></app-text-input>
    </div>

    <div class="create-step__editor">
      <app-editor
        [label]="'Décrivez cette étape'"
        [content]="stepEditorContent"
        (contentChange)="onEditorChange($event)"
      ></app-editor>
    </div>
  </section>

  @if (errorMessage) {
    <p class="create-step__error">{{ errorMessage }}</p>
  }

  <div class="create-step__actions">
    <app-button
      text="Annuler"
      color="secondary"
      size="auto"
      radius="border_lg"
      htmlType="button"
      [isDisabled]="isSubmitting"
      (btnClick)="handleCancel()"
    ></app-button>
    <app-button
      text="Enregistrer l'étape"
      color="primary"
      size="auto"
      radius="border_lg"
      htmlType="submit"
      [isDisabled]="stepForm.invalid || isSubmitting"
    ></app-button>
  </div>
</form>
